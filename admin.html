<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Quản trị CLB Âm nhạc ĐH Đà Lạt</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      .tab-active {
        @apply bg-blue-600 text-white;
      }
    </style>
  </head>
  <body class="bg-gray-50">
    <!-- Header giống trang chủ -->
    <nav class="bg-white shadow-lg fixed w-full z-50">
      <div class="container mx-auto px-4">
        <div class="flex justify-between items-center py-4">
          <div class="flex items-center">
            <a href="index.html" class="flex items-center">
              <img src="images/logo.png" alt="Logo CLB" class="h-12 w-auto" />
              <span class="ml-3 text-xl font-semibold text-gray-800"
                >CLB Âm nhạc ĐH Đà Lạt</span
              >
            </a>
          </div>
          <div class="hidden md:flex space-x-8">
            <a
              href="index.html#overview"
              class="text-gray-600 hover:text-blue-600"
              >Giới thiệu</a
            >
            <a
              href="index.html#events"
              class="text-gray-600 hover:text-blue-600"
              >Sự kiện</a
            >
            <a
              href="index.html#gallery"
              class="text-gray-600 hover:text-blue-600"
              >Thư viện</a
            >
            <a
              href="index.html#members"
              class="text-gray-600 hover:text-blue-600"
              >Thành viên</a
            >
            <a
              href="index.html#contact"
              class="text-gray-600 hover:text-blue-600"
              >Liên hệ</a
            >
          </div>
        </div>
      </div>
    </nav>

    <!-- Tabs chức năng quản trị -->
    <section class="pt-36 pb-20 min-h-screen container mx-auto px-4">
      <h2 class="text-3xl font-bold text-blue-700 mb-8 text-center">
        Trang Quản trị CLB Âm nhạc
      </h2>
      <div class="flex justify-center mb-8">
        <button
          class="tab-btn bg-blue-100 text-blue-700 px-6 py-2 rounded-l-full font-semibold border border-blue-600 hover:bg-blue-200 transition"
          data-tab="members"
        >
          Thành viên
        </button>
        <button
          class="tab-btn bg-white text-blue-600 px-6 py-2 font-semibold border-t border-b border-blue-600 hover:bg-blue-50 transition"
          data-tab="events"
        >
          Sự kiện
        </button>
        <button
          class="tab-btn bg-white text-blue-600 px-6 py-2 font-semibold border-t border-b border-blue-600 hover:bg-blue-50 transition"
          data-tab="gallery"
        >
          Thư viện
        </button>
        <button
          class="tab-btn bg-white text-blue-600 px-6 py-2 rounded-r-full font-semibold border border-blue-600 hover:bg-blue-50 transition"
          data-tab="contact"
        >
          Liên hệ/Góp ý
        </button>
      </div>
      <!-- Tab nội dung -->
      <div id="tab-members" class="tab-content">
        <h3 class="text-xl font-bold mb-4 text-blue-600">
          <i class="fa fa-users mr-2"></i> Quản lý thành viên
        </h3>
        <div class="mb-8 bg-white rounded shadow p-4">
          <h4 class="text-lg font-semibold mb-2 text-blue-700">
            Biểu đồ số lượng thành viên theo từng tháng
          </h4>
          <canvas id="memberChart" height="120"></canvas>
          <div class="text-sm text-gray-500 mt-2">
            Minh họa số lượng thành viên của CLB qua các tháng trong năm.
          </div>
        </div>
        <div class="mb-4 flex justify-between items-center">
          <button
            class="bg-blue-600 text-white px-4 py-2 rounded font-semibold hover:bg-blue-700 transition"
            id="showMemberFormBtn"
          >
            <i class="fa fa-user-plus mr-2"></i>Thêm thành viên
          </button>
        </div>
        <div class="overflow-x-auto">
          <table class="min-w-full bg-white rounded shadow" id="memberTable">
            <thead class="bg-blue-100">
              <tr>
                <th class="py-2 px-4 text-left">Họ tên</th>
                <th class="py-2 px-4 text-left">MSSV</th>
                <th class="py-2 px-4 text-left">Email</th>
                <th class="py-2 px-4 text-left">Vai trò</th>
                <th class="py-2 px-4 text-left">Thao tác</th>
              </tr>
            </thead>
            <tbody>
              <!-- Thành viên sẽ render bằng JS -->
            </tbody>
          </table>
        </div>
        <!-- Form thêm thành viên (THÊM thuộc tính hidden) -->
        <div
          id="memberFormWrapper"
          class="mb-8 bg-white rounded shadow p-4 hidden"
        >
          <h4
            class="text-lg font-semibold mb-4 text-blue-700"
            id="memberFormTitle"
          >
            Thêm thành viên mới
          </h4>
          <form id="memberForm" class="space-y-4">
            <div>
              <label class="block font-semibold mb-1">Họ tên</label>
              <input
                type="text"
                required
                oninvalid="this.setCustomValidity('Vui lòng nhập họ tên!')"
                oninput="this.setCustomValidity('')"
                class="w-full border rounded px-3 py-2"
                id="memberName"
              />
            </div>
            <div>
              <label class="block font-semibold mb-1">Mã số sinh viên</label>
              <input
                type="text"
                required
                oninvalid="this.setCustomValidity('Vui lòng nhập MSSV!')"
                oninput="this.setCustomValidity('')"
                class="w-full border rounded px-3 py-2"
                id="memberMSSV"
              />
            </div>
            <div>
              <label class="block font-semibold mb-1">Email</label>
              <input
                type="email"
                required
                oninvalid="this.setCustomValidity('Vui lòng nhập email!')"
                oninput="this.setCustomValidity('')"
                class="w-full border rounded px-3 py-2"
                id="memberEmail"
              />
            </div>
            <div>
              <label class="block font-semibold mb-1">Vai trò</label>
              <select
                required
                oninvalid="this.setCustomValidity('Vui lòng chọn vai trò!')"
                oninput="this.setCustomValidity('')"
                class="w-full border rounded px-3 py-2"
                id="memberRole"
              >
                <option value="">-- Chọn vai trò --</option>
                <option value="Ban chủ nhiệm">Ban chủ nhiệm</option>
                <option value="Thành viên">Thành viên</option>
              </select>
            </div>
            <button
              type="submit"
              id="memberSubmitBtn"
              class="bg-blue-600 text-white px-4 py-2 rounded font-semibold hover:bg-blue-700 transition"
            >
              <i class="fa fa-plus mr-2"></i>Thêm thành viên
            </button>
            <button
              type="button"
              id="memberCancelBtn"
              class="ml-2 bg-gray-300 text-gray-700 px-4 py-2 rounded font-semibold hover:bg-gray-400 transition hidden"
            >
              Hủy
            </button>
          </form>
        </div>
      </div>
      <div id="tab-events" class="tab-content hidden">
        <h3 class="text-xl font-bold mb-4 text-blue-600">
          <i class="fa fa-calendar-alt mr-2"></i> Quản lý sự kiện
        </h3>
        <!-- Biểu đồ lượt đăng ký sự kiện -->
        <div class="mb-8 bg-white rounded shadow p-4">
          <h4 class="text-lg font-semibold mb-2 text-blue-700">
            Biểu đồ lượt đăng ký sự kiện theo thời gian
          </h4>
          <canvas id="eventChart" height="120"></canvas>
          <div class="text-sm text-gray-500 mt-2">
            Biểu đồ thể hiện số lượt đăng ký của từng sự kiện qua các mốc thời
            gian.
          </div>
        </div>
        <!-- Form đăng tin/sửa sự kiện (THÊM thuộc tính hidden) -->
        <div
          id="eventFormWrapper"
          class="mb-8 bg-white rounded shadow p-4 hidden"
        >
          <h4
            class="text-lg font-semibold mb-4 text-blue-700"
            id="eventFormTitle"
          >
            Đăng tin sự kiện mới
          </h4>
          <form id="eventForm" class="space-y-4">
            <div>
              <label class="block font-semibold mb-1">Tên sự kiện</label>
              <input
                type="text"
                required
                oninvalid="this.setCustomValidity('Vui lòng nhập tên sự kiện!')"
                oninput="this.setCustomValidity('')"
                class="w-full border rounded px-3 py-2"
                id="eventName"
              />
            </div>
            <div>
              <label class="block font-semibold mb-1">Loại sự kiện</label>
              <select
                required
                oninvalid="this.setCustomValidity('Vui lòng chọn loại sự kiện!')"
                oninput="this.setCustomValidity('')"
                class="w-full border rounded px-3 py-2"
                id="eventType"
              >
                <option value="">-- Chọn loại sự kiện --</option>
                <option value="Sự kiện">Sự kiện</option>
                <option value="Chia sẻ">Chia sẻ</option>
                <option value="Thành tựu">Thành tựu</option>
              </select>
            </div>
            <div>
              <label class="block font-semibold mb-1">Thời gian</label>
              <input
                type="date"
                required
                oninvalid="this.setCustomValidity('Vui lòng chọn thời gian!')"
                oninput="this.setCustomValidity('')"
                class="w-full border rounded px-3 py-2"
                id="eventDate"
              />
            </div>
            <div>
              <label class="block font-semibold mb-1">Địa điểm</label>
              <input
                type="text"
                required
                oninvalid="this.setCustomValidity('Vui lòng nhập địa điểm!')"
                oninput="this.setCustomValidity('')"
                class="w-full border rounded px-3 py-2"
                id="eventLocation"
              />
            </div>
            <div>
              <label class="block font-semibold mb-1">Ảnh sự kiện</label>
              <input
                type="file"
                accept="image/*"
                class="w-full border rounded px-3 py-2"
                id="eventImage"
              />
              <img
                id="previewImage"
                class="mt-2 h-24 rounded shadow hidden"
                alt="Preview"
              />
            </div>
            <div>
              <label class="block font-semibold mb-1">Mô tả sự kiện</label>
              <textarea
                required
                oninvalid="this.setCustomValidity('Vui lòng nhập mô tả sự kiện!')"
                oninput="this.setCustomValidity('')"
                class="w-full border rounded px-3 py-2"
                rows="3"
                id="eventDesc"
              ></textarea>
            </div>
            <button
              type="submit"
              id="eventSubmitBtn"
              class="bg-blue-600 text-white px-4 py-2 rounded font-semibold hover:bg-blue-700 transition"
            >
              <i class="fa fa-plus mr-2"></i>Đăng tin sự kiện
            </button>
            <button
              type="button"
              id="eventCancelBtn"
              class="ml-2 bg-gray-300 text-gray-700 px-4 py-2 rounded font-semibold hover:bg-gray-400 transition hidden"
            >
              Hủy
            </button>
          </form>
        </div>
        <div class="mb-4 flex justify-between items-center">
          <button
            class="bg-blue-600 text-white px-4 py-2 rounded font-semibold hover:bg-blue-700 transition"
            id="showEventFormBtn"
          >
            <i class="fa fa-plus mr-2"></i>Thêm sự kiện
          </button>
        </div>
        <div class="overflow-x-auto">
          <table class="min-w-full bg-white rounded shadow" id="eventTable">
            <thead class="bg-blue-100">
              <tr>
                <th class="py-2 px-4 text-left">Tên sự kiện</th>
                <th class="py-2 px-4 text-left">Loại</th>
                <th class="py-2 px-4 text-left">Thời gian</th>
                <th class="py-2 px-4 text-left">Địa điểm</th>
                <th class="py-2 px-4 text-left">Thao tác</th>
              </tr>
            </thead>
            <tbody>
              <!-- Sự kiện sẽ render bằng JS -->
            </tbody>
          </table>
        </div>
      </div>
      <div id="tab-gallery" class="tab-content hidden">
        <h3 class="text-xl font-bold mb-4 text-blue-600">
          <i class="fa fa-image mr-2"></i> Quản lý thư viện ảnh/video
        </h3>
        <div class="mb-4 flex justify-between items-center">
          <button
            class="bg-blue-600 text-white px-4 py-2 rounded font-semibold hover:bg-blue-700 transition"
            onclick="alert('Chức năng thêm ảnh/video sẽ kết nối database sau!')"
          >
            <i class="fa fa-plus mr-2"></i>Thêm ảnh/video
          </button>
        </div>
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
          <div
            class="bg-gray-100 rounded shadow p-2 flex flex-col items-center"
          >
            <img
              src="images/member-01.jpg"
              alt="Ảnh hoạt động"
              class="h-32 w-auto object-cover rounded mb-2"
            />
            <button
              class="text-red-600 hover:underline"
              onclick="alert('Xóa ảnh sẽ kết nối database sau!')"
            >
              Xóa
            </button>
          </div>
          <div
            class="bg-gray-100 rounded shadow p-2 flex flex-col items-center"
          >
            <img
              src="images/logo.png"
              alt="Logo CLB"
              class="h-32 w-auto object-cover rounded mb-2"
            />
            <button
              class="text-red-600 hover:underline"
              onclick="alert('Xóa ảnh sẽ kết nối database sau!')"
            >
              Xóa
            </button>
          </div>
        </div>
      </div>
      <div id="tab-contact" class="tab-content hidden">
        <h3 class="text-xl font-bold mb-4 text-blue-600">
          <i class="fa fa-envelope mr-2"></i> Quản lý liên hệ/góp ý
        </h3>
        <div class="overflow-x-auto">
          <table class="min-w-full bg-white rounded shadow">
            <thead class="bg-blue-100">
              <tr>
                <th class="py-2 px-4">Tên</th>
                <th class="py-2 px-4">Email</th>
                <th class="py-2 px-4">Nội dung góp ý</th>
                <th class="py-2 px-4">Thao tác</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="py-2 px-4">Lê Văn C</td>
                <td class="py-2 px-4">levanc@student.dlu.edu.vn</td>
                <td class="py-2 px-4">
                  CLB nên tổ chức thêm nhiều sự kiện ngoài trời!
                </td>
                <td class="py-2 px-4">
                  <button
                    class="text-blue-600 hover:underline"
                    onclick="openRespondForm('levanc@student.dlu.edu.vn')"
                  >
                    Phản hồi
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
        <!-- Form phản hồi góp ý (THÊM thuộc tính hidden) -->
        <div
          id="respondFormWrapper"
          class="mb-8 bg-white rounded shadow p-4 hidden"
        >
          <h4 class="text-lg font-semibold mb-4 text-blue-700">
            Phản hồi góp ý
          </h4>
          <form id="respondForm" class="space-y-4">
            <div>
              <label class="block font-semibold mb-1">Nội dung phản hồi</label>
              <textarea
                required
                oninvalid="this.setCustomValidity('Vui lòng nhập nội dung phản hồi!')"
                oninput="this.setCustomValidity('')"
                class="w-full border rounded px-3 py-2"
                rows="3"
                id="respondContent"
              ></textarea>
            </div>
            <button
              type="submit"
              class="bg-blue-600 text-white px-4 py-2 rounded font-semibold hover:bg-blue-700 transition"
            >
              Gửi phản hồi
            </button>
            <button
              type="button"
              id="respondCancelBtn"
              class="ml-2 bg-gray-300 text-gray-700 px-4 py-2 rounded font-semibold hover:bg-gray-400 transition"
            >
              Hủy
            </button>
          </form>
        </div>
      </div>
      <div class="mt-12 text-center">
        <a href="index.html" class="text-blue-600 hover:underline"
          >Quay về trang chủ</a
        >
      </div>
    </section>

    <!-- Footer giống trang chủ -->
    <footer class="bg-gray-800 text-white py-8">
      <div class="container mx-auto px-4 text-center">
        <p>© 2025 Câu lạc bộ Âm nhạc Đại học Đà Lạt. All rights reserved.</p>
      </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
      // Tab chuyển đổi
      const tabBtns = document.querySelectorAll(".tab-btn");
      const tabContents = document.querySelectorAll(".tab-content");
      tabBtns.forEach((btn) => {
        btn.addEventListener("click", function () {
          tabBtns.forEach((b, i) => {
            b.classList.remove("bg-blue-100", "text-blue-700");
            b.classList.add("bg-white", "text-blue-600");
            if (i === 0) b.classList.add("rounded-l-full");
            if (i === tabBtns.length - 1) b.classList.add("rounded-r-full");
          });
          this.classList.remove("bg-white", "text-blue-600");
          this.classList.add("bg-blue-100", "text-blue-700");
          tabContents.forEach((c) => c.classList.add("hidden"));
          document
            .getElementById("tab-" + this.dataset.tab)
            .classList.remove("hidden");
          // Vẽ lại biểu đồ khi chuyển tab sự kiện
          if (this.dataset.tab === "events") {
            setTimeout(drawEventChart, 100);
          }
        });
      });
      // Mặc định tab đầu tiên
      tabBtns.forEach((b, i) => {
        b.classList.remove("bg-blue-100", "text-blue-700");
        b.classList.add("bg-white", "text-blue-600");
        if (i === 0) b.classList.add("rounded-l-full");
        if (i === tabBtns.length - 1) b.classList.add("rounded-r-full");
      });
      tabBtns[0].classList.remove("bg-white", "text-blue-600");
      tabBtns[0].classList.add("bg-blue-100", "text-blue-700");
      tabContents[0].classList.remove("hidden");
      // Biểu đồ sự kiện trực quan hơn
      function drawEventChart() {
        const ctx = document.getElementById("eventChart");
        if (!ctx) return;
        if (window.eventChartInstance) window.eventChartInstance.destroy();
        // Tạo gradient màu cho line
        const gradient = ctx
          .getContext("2d")
          .createLinearGradient(0, 0, 0, 120);
        gradient.addColorStop(0, "#2563eb");
        gradient.addColorStop(1, "#38bdf8");
        window.eventChartInstance = new Chart(ctx, {
          type: "line",
          data: {
            labels: ["Tháng 7", "Tháng 8", "Tháng 9", "Tháng 10", "Tháng 11"],
            datasets: [
              {
                label: "Giao lưu âm nhạc 2025",
                data: [20, 40, 60, 90, 120],
                borderColor: gradient,
                backgroundColor: "rgba(56,189,248,0.1)",
                fill: true,
                tension: 0.4,
                pointBackgroundColor: "#2563eb",
                pointBorderColor: "#2563eb",
                pointRadius: 5,
              },
              {
                label: "Workshop Guitar",
                data: [10, 25, 40, 60, 75],
                borderColor: "#f59e42",
                backgroundColor: "rgba(245,158,66,0.1)",
                fill: true,
                tension: 0.4,
                pointBackgroundColor: "#f59e42",
                pointBorderColor: "#f59e42",
                pointRadius: 5,
              },
            ],
          },
          options: {
            responsive: true,
            plugins: {
              legend: { display: true, position: "top" },
              title: { display: false },
              tooltip: { enabled: true },
            },
            scales: {
              y: {
                beginAtZero: true,
                title: { display: true, text: "Lượt đăng ký" },
              },
              x: { title: { display: true, text: "Thời gian" } },
            },
          },
        });
      }
      // Vẽ biểu đồ khi load trang nếu tab sự kiện đang mở
      if (!tabContents[0].classList.contains("hidden")) {
        setTimeout(drawEventChart, 100);
      }
      // Dữ liệu sự kiện tạm thời
      let events = [
        {
          name: "Giao lưu âm nhạc 2025",
          type: "Sự kiện",
          date: "2025-10-20",
          location: "Hội trường A",
          image: "",
          desc: "Điểm lại những khoảnh khắc đáng nhớ và thành công của chuỗi sự kiện âm nhạc trong mùa hè...",
        },
        {
          name: "Workshop Guitar",
          type: "Chia sẻ",
          date: "2025-11-15",
          location: "Phòng 203",
          image: "",
          desc: "Những bí quyết quan trọng giúp bạn tiến bộ nhanh chóng trong việc đàn guitar từ các thành viên kỳ cựu...",
        },
      ];
      let editIndex = null;

      // Render bảng sự kiện
      function renderEventTable() {
        const tbody = document.querySelector("#eventTable tbody");
        tbody.innerHTML = "";
        events.forEach((ev, idx) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td class="py-2 px-4">${ev.name}</td>
            <td class="py-2 px-4">${ev.type}</td>
            <td class="py-2 px-4">${formatDate(ev.date)}</td>
            <td class="py-2 px-4">${ev.location}</td>
            <td class="py-2 px-4">
              <button class="text-blue-600 hover:underline mr-2" onclick="editEvent(${idx})">Sửa</button>
              <button class="text-red-600 hover:underline" onclick="deleteEvent(${idx})">Xóa</button>
            </td>
          `;
          tbody.appendChild(tr);
        });
      }
      window.renderEventTable = renderEventTable; // Để gọi lại sau khi sửa/xóa

      // Format ngày
      function formatDate(dateStr) {
        const d = new Date(dateStr);
        return d.toLocaleDateString("vi-VN");
      }

      // Sửa sự kiện
      window.editEvent = function (idx) {
        editIndex = idx;
        const ev = events[idx];
        document.getElementById("eventName").value = ev.name;
        document.getElementById("eventType").value = ev.type;
        document.getElementById("eventDate").value = ev.date;
        document.getElementById("eventLocation").value = ev.location;
        document.getElementById("eventDesc").value = ev.desc;
        document.getElementById("previewImage").src = ev.image || "";
        document
          .getElementById("previewImage")
          .classList.toggle("hidden", !ev.image);
        document.getElementById("eventFormTitle").textContent = "Sửa sự kiện";
        document.getElementById("eventSubmitBtn").innerHTML =
          '<i class="fa fa-save mr-2"></i>Cập nhật sự kiện';
        document.getElementById("eventCancelBtn").classList.remove("hidden");
        // Thêm dòng này để mở form sửa sự kiện
        document.getElementById("eventFormWrapper").classList.remove("hidden");
      };

      // Xóa sự kiện
      window.deleteEvent = function (idx) {
        if (confirm("Bạn có chắc muốn xóa sự kiện này?")) {
          events.splice(idx, 1);
          renderEventTable();
        }
      };

      // Hiện form khi nhấn "Thêm sự kiện"
      document.getElementById("showEventFormBtn").onclick = function () {
        resetEventForm();
        document.getElementById("eventFormWrapper").classList.remove("hidden");
      };
      // Ẩn form khi nhấn "Hủy" hoặc thêm/sửa xong
      function resetEventForm() {
        editIndex = null;
        document.getElementById("eventForm").reset();
        document.getElementById("previewImage").classList.add("hidden");
        document.getElementById("previewImage").src = "";
        document.getElementById("eventFormTitle").textContent =
          "Đăng tin sự kiện mới";
        document.getElementById("eventSubmitBtn").innerHTML =
          '<i class="fa fa-plus mr-2"></i>Đăng tin sự kiện';
        document.getElementById("eventCancelBtn").classList.add("hidden");
        document.getElementById("eventFormWrapper").classList.remove("hidden");
      }
      document.getElementById("eventCancelBtn").onclick = function () {
        document.getElementById("eventFormWrapper").classList.add("hidden");
      };
      // Ẩn form sau khi submit
      document
        .getElementById("eventForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const name = document.getElementById("eventName").value.trim();
          const type = document.getElementById("eventType").value;
          const date = document.getElementById("eventDate").value;
          const location = document
            .getElementById("eventLocation")
            .value.trim();
          const desc = document.getElementById("eventDesc").value.trim();
          const imgEl = document.getElementById("previewImage");
          const image =
            imgEl.src && !imgEl.classList.contains("hidden") ? imgEl.src : "";

          if (!name || !type || !date || !location || !desc) {
            alert("Vui lòng nhập đầy đủ thông tin sự kiện!");
            return;
          }

          if (editIndex !== null) {
            // Cập nhật sự kiện
            events[editIndex] = { name, type, date, location, image, desc };
            alert("Cập nhật sự kiện thành công!");
          } else {
            // Thêm mới sự kiện
            events.push({ name, type, date, location, image, desc });
            alert("Đăng tin sự kiện thành công!");
          }
          renderEventTable();
          resetEventForm();
          document.getElementById("eventFormWrapper").classList.add("hidden");
        });

      // Dữ liệu thành viên tạm thời
      let members = [
        {
          name: "Nguyễn Văn A",
          mssv: "2012345",
          email: "vana@dlu.edu.vn",
          role: "Ban chủ nhiệm",
        },
        {
          name: "Trần Thị B",
          mssv: "2016789",
          email: "thib@dlu.edu.vn",
          role: "Thành viên",
        },
      ];
      let memberEditIndex = null;

      // Render bảng thành viên
      function renderMemberTable() {
        const tbody = document.querySelector("#memberTable tbody");
        tbody.innerHTML = "";
        members.forEach((mb, idx) => {
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td class="py-2 px-4">${mb.name}</td>
            <td class="py-2 px-4">${mb.mssv}</td>
            <td class="py-2 px-4">${mb.email}</td>
            <td class="py-2 px-4">${mb.role}</td>
            <td class="py-2 px-4">
              <button class="text-blue-600 hover:underline mr-2" onclick="editMember(${idx})">Sửa</button>
              <button class="text-red-600 hover:underline" onclick="deleteMember(${idx})">Xóa</button>
            </td>
          `;
          tbody.appendChild(tr);
        });
      }
      window.renderMemberTable = renderMemberTable;

      // Sửa thành viên
      window.editMember = function (idx) {
        memberEditIndex = idx;
        const mb = members[idx];
        document.getElementById("memberName").value = mb.name;
        document.getElementById("memberMSSV").value = mb.mssv;
        document.getElementById("memberEmail").value = mb.email;
        document.getElementById("memberRole").value = mb.role;
        document.getElementById("memberFormTitle").textContent =
          "Sửa thành viên";
        document.getElementById("memberSubmitBtn").innerHTML =
          '<i class="fa fa-save mr-2"></i>Cập nhật thành viên';
        document.getElementById("memberCancelBtn").classList.remove("hidden");
        document.getElementById("memberFormWrapper").classList.remove("hidden");
      };

      // Xóa thành viên
      window.deleteMember = function (idx) {
        if (confirm("Bạn có chắc muốn xóa thành viên này?")) {
          members.splice(idx, 1);
          renderMemberTable();
        }
      };

      // Hiện form khi nhấn "Thêm thành viên"
      document.getElementById("showMemberFormBtn").onclick = function () {
        resetMemberForm();
        document.getElementById("memberFormWrapper").classList.remove("hidden");
      };
      // Ẩn form khi nhấn "Hủy" hoặc thêm/sửa xong
      function resetMemberForm() {
        memberEditIndex = null;
        document.getElementById("memberForm").reset();
        document.getElementById("memberFormTitle").textContent =
          "Thêm thành viên mới";
        document.getElementById("memberSubmitBtn").innerHTML =
          '<i class="fa fa-plus mr-2"></i>Thêm thành viên';
        document.getElementById("memberCancelBtn").classList.add("hidden");
      }
      document.getElementById("memberCancelBtn").onclick = function () {
        document.getElementById("memberFormWrapper").classList.add("hidden");
      };
      // Ẩn form sau khi submit
      document
        .getElementById("memberForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const name = document.getElementById("memberName").value.trim();
          const mssv = document.getElementById("memberMSSV").value.trim();
          const email = document.getElementById("memberEmail").value.trim();
          const role = document.getElementById("memberRole").value;
          if (!name || !mssv || !email || !role) {
            alert("Vui lòng nhập đầy đủ thông tin thành viên!");
            return;
          }
          if (memberEditIndex !== null) {
            // Cập nhật thành viên
            members[memberEditIndex] = { name, mssv, email, role };
            alert("Cập nhật thành viên thành công!");
          } else {
            // Thêm mới thành viên
            members.push({ name, mssv, email, role });
            alert("Thêm thành viên thành công!");
          }
          renderMemberTable();
          resetMemberForm();
          document.getElementById("memberFormWrapper").classList.add("hidden");
        });

      // Mặc định tab đầu tiên
      tabBtns.forEach((b, i) => {
        b.classList.remove("bg-blue-100", "text-blue-700");
        b.classList.add("bg-white", "text-blue-600");
        if (i === 0) b.classList.add("rounded-l-full");
        if (i === tabBtns.length - 1) b.classList.add("rounded-r-full");
      });
      tabBtns[0].classList.remove("bg-white", "text-blue-600");
      tabBtns[0].classList.add("bg-blue-100", "text-blue-700");
      tabContents[0].classList.remove("hidden");
      // Biểu đồ sự kiện trực quan hơn
      function drawEventChart() {
        const ctx = document.getElementById("eventChart");
        if (!ctx) return;
        if (window.eventChartInstance) window.eventChartInstance.destroy();
        // Tạo gradient màu cho line
        const gradient = ctx
          .getContext("2d")
          .createLinearGradient(0, 0, 0, 120);
        gradient.addColorStop(0, "#2563eb");
        gradient.addColorStop(1, "#38bdf8");
        window.eventChartInstance = new Chart(ctx, {
          type: "line",
          data: {
            labels: ["Tháng 7", "Tháng 8", "Tháng 9", "Tháng 10", "Tháng 11"],
            datasets: [
              {
                label: "Giao lưu âm nhạc 2025",
                data: [20, 40, 60, 90, 120],
                borderColor: gradient,
                backgroundColor: "rgba(56,189,248,0.1)",
                fill: true,
                tension: 0.4,
                pointBackgroundColor: "#2563eb",
                pointBorderColor: "#2563eb",
                pointRadius: 5,
              },
              {
                label: "Workshop Guitar",
                data: [10, 25, 40, 60, 75],
                borderColor: "#f59e42",
                backgroundColor: "rgba(245,158,66,0.1)",
                fill: true,
                tension: 0.4,
                pointBackgroundColor: "#f59e42",
                pointBorderColor: "#f59e42",
                pointRadius: 5,
              },
            ],
          },
          options: {
            responsive: true,
            plugins: {
              legend: { display: true, position: "top" },
              title: { display: false },
              tooltip: { enabled: true },
            },
            scales: {
              y: {
                beginAtZero: true,
                title: { display: true, text: "Lượt đăng ký" },
              },
              x: { title: { display: true, text: "Thời gian" } },
            },
          },
        });
      }
      // Vẽ biểu đồ khi load trang nếu tab sự kiện đang mở
      if (!tabContents[0].classList.contains("hidden")) {
        setTimeout(drawEventChart, 100);
      }
      // Xem trước ảnh sự kiện khi chọn file
      document
        .getElementById("eventImage")
        ?.addEventListener("change", function (e) {
          const file = e.target.files[0];
          const preview = document.getElementById("previewImage");
          if (file) {
            const reader = new FileReader();
            reader.onload = function (ev) {
              preview.src = ev.target.result;
              preview.classList.remove("hidden");
            };
            reader.readAsDataURL(file);
          } else {
            preview.classList.add("hidden");
            preview.src = "";
          }
        });
      // Khởi tạo bảng sự kiện khi trang vừa load
      renderEventTable();
      renderMemberTable();

      // Biểu đồ số lượng thành viên theo tháng (Bar Chart)
      function drawMemberChart() {
        const ctx = document.getElementById("memberChart");
        if (!ctx) return;
        if (window.memberChartInstance) window.memberChartInstance.destroy();

        // Dữ liệu minh họa biến động số lượng thành viên từng tháng
        const months = [
          "Tháng 1",
          "Tháng 2",
          "Tháng 3",
          "Tháng 4",
          "Tháng 5",
          "Tháng 6",
          "Tháng 7",
          "Tháng 8",
          "Tháng 9",
          "Tháng 10",
          "Tháng 11",
          "Tháng 12",
        ];
        // Số lượng thành viên biến động: có tháng tăng, có tháng giảm
        const memberCounts = [30, 32, 29, 31, 28, 30, 33, 31, 34, 32, 35, 33];

        window.memberChartInstance = new Chart(ctx, {
          type: "bar",
          data: {
            labels: months,
            datasets: [
              {
                label: "Số lượng thành viên",
                data: memberCounts,
                backgroundColor: "#2563eb",
                borderRadius: 6,
              },
            ],
          },
          options: {
            responsive: true,
            plugins: {
              legend: { display: false },
              title: { display: false },
              tooltip: { enabled: true },
            },
            scales: {
              y: {
                beginAtZero: true,
                title: { display: true, text: "Thành viên" },
              },
              x: { title: { display: true, text: "Tháng" } },
            },
          },
        });
      }

      // Vẽ biểu đồ khi tab thành viên mở
      document
        .querySelector('[data-tab="members"]')
        .addEventListener("click", function () {
          setTimeout(drawMemberChart, 100);
        });
      // Vẽ biểu đồ khi load trang nếu tab thành viên đang mở
      if (
        !document.getElementById("tab-members").classList.contains("hidden")
      ) {
        setTimeout(drawMemberChart, 100);
      }
      window.openRespondForm = function (email) {
        document
          .getElementById("respondFormWrapper")
          .classList.remove("hidden");
        document.getElementById("respondContent").value = "";
        document.getElementById("respondFormWrapper").dataset.email = email;
      };
      document.getElementById("respondCancelBtn").onclick = function () {
        document.getElementById("respondFormWrapper").classList.add("hidden");
      };
      document
        .getElementById("respondForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();
          const content = document
            .getElementById("respondContent")
            .value.trim();
          const email =
            document.getElementById("respondFormWrapper").dataset.email;
          if (!content) {
            alert("Vui lòng nhập nội dung phản hồi!");
            return;
          }
          // Giả lập gửi phản hồi thành công
          setTimeout(() => {
            alert("Gửi phản hồi thành công!");
            document
              .getElementById("respondFormWrapper")
              .classList.add("hidden");
          }, 500);
        });
      let feedbacks = [
        {
          name: "Lê Văn C",
          email: "levanc@student.dlu.edu.vn",
          content: "CLB nên tổ chức thêm nhiều sự kiện ngoài trời!",
          responded: false,
        },
      ];
      function renderFeedbackTable() {
        const tbody = document.querySelector("#tab-contact table tbody");
        tbody.innerHTML = "";
        feedbacks.forEach((fb, idx) => {
          tbody.innerHTML += `
      <tr>
        <td class="py-2 px-4">${fb.name}</td>
        <td class="py-2 px-4">${fb.email}</td>
        <td class="py-2 px-4">${fb.content}</td>
        <td class="py-2 px-4">
          ${
            fb.responded
              ? '<span class="text-green-600 font-bold"><i class="fa fa-check-circle"></i> Đã phản hồi</span>'
              : `<button class="text-blue-600 hover:underline" onclick="openRespondForm('${fb.email}', ${idx})">Phản hồi</button>`
          }
        </td>
      </tr>
    `;
        });
      }
      window.renderFeedbackTable = renderFeedbackTable;
    </script>
  </body>
</html>
